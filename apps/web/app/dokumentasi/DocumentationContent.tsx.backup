'use client';

import { useState, useEffect } from 'react';
import { 
  ChevronRight, Users, BookOpen, Layout, Shield, Zap, Code, 
  Home, Settings, FileText, Calendar, Bell, Menu, X, GraduationCap, UserCheck
} from 'lucide-react';
import Link from 'next/link';
import Image from 'next/image';
import TeamMemberCard from '../components/landing-page/TeamMemberCard';

// Data tim pengembang
const teamMembers = [
  {
    name: 'Erland Agsya Agustian',
    role: 'Frontend Developer',
    id: '2311083007',
    image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTYB48qcI4RmLRUfQqoGwJb6GIM7SqYE9rcBg&s',
  },
  {
    name: 'Nabil Achmad Khoir',
    role: 'Project Manager',
    id: '2311082032',
    image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTYB48qcI4RmLRUfQqoGwJb6GIM7SqYE9rcBg&s',
  },
  {
    name: 'Kasih Ananda Nardi',
    role: 'Sistem Analis',
    id: '2311081021',
    image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTYB48qcI4RmLRUfQqoGwJb6GIM7SqYE9rcBg&s',
  },
  {
    name: 'Gilang Dwi Yuwana',
    role: 'Backend Developer',
    id: '2311081016',
    image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTYB48qcI4RmLRUfQqoGwJb6GIM7SqYE9rcBg&s',
  },
];

// Menu dokumentasi - Struktur hirarkis seperti NestJS
const menuItems = [
  {
    id: 'team',
    label: 'Tim Pengembang',
    icon: Users,
  },
  {
    id: 'introduction',
    label: 'Pengenalan',
    icon: BookOpen,
    children: [
      { id: 'intro-overview', label: 'Tentang SITA-BI' },
      { id: 'intro-architecture', label: 'Arsitektur Sistem' },
      { id: 'intro-requirements', label: 'Persyaratan Sistem' },
    ]
  },
  {
    id: 'getting-started',
    label: 'Memulai',
    icon: Home,
    children: [
      { id: 'gs-registration', label: 'Registrasi Akun' },
      { id: 'gs-login', label: 'Login & Autentikasi' },
      { id: 'gs-dashboard', label: 'Navigasi Dashboard' },
    ]
  },
  {
    id: 'mahasiswa',
    label: 'Panduan Mahasiswa',
    icon: GraduationCap,
    children: [
      { id: 'mhs-topik', label: 'Memilih Topik TA' },
      { id: 'mhs-bimbingan', label: 'Sistem Bimbingan' },
      { id: 'mhs-sidang', label: 'Jadwal Sidang' },
      { id: 'mhs-pengumuman', label: 'Pengumuman' },
    ]
  },
  {
    id: 'dosen',
    label: 'Panduan Dosen',
    icon: UserCheck,
    children: [
      { id: 'dsn-topik', label: 'Kelola Tawaran Topik' },
      { id: 'dsn-bimbingan', label: 'Bimbingan Mahasiswa' },
      { id: 'dsn-penilaian', label: 'Penilaian Sidang' },
      { id: 'dsn-approval', label: 'Persetujuan' },
    ]
  },
  {
    id: 'admin',
    label: 'Panduan Admin',
    icon: Shield,
    children: [
      { id: 'adm-users', label: 'Manajemen User' },
      { id: 'adm-jadwal', label: 'Pengaturan Jadwal' },
      { id: 'adm-pengumuman', label: 'Kelola Pengumuman' },
      { id: 'adm-laporan', label: 'Laporan Sistem' },
    ]
  },
  {
    id: 'features',
    label: 'Fitur & Modul',
    icon: Layout,
  },
  {
    id: 'technology',
    label: 'Teknologi',
    icon: Zap,
  },
];

export default function DocumentationContent() {
  const [activeSection, setActiveSection] = useState('team');
  const [sidebarOpen, setSidebarOpen] = useState(false);
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const [expandedMenus, setExpandedMenus] = useState<string[]>(['introduction', 'getting-started']);

  const scrollToSection = (id: string) => {
    setActiveSection(id);
    const element = document.getElementById(id);
    if (element) {
      const headerOffset = 100;
      const elementPosition = element.getBoundingClientRect().top;
      const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
      
      window.scrollTo({
        top: offsetPosition,
        behavior: 'smooth'
      });
    }
    setSidebarOpen(false);
  };

  const toggleMenu = (id: string) => {
    setExpandedMenus(prev => 
      prev.includes(id) 
        ? prev.filter(item => item !== id)
        : [...prev, id]
    );
  };

  // Track scroll position for active section
  useEffect(() => {
    const handleScroll = () => {
      const sections = menuItems.flatMap(item => {
        if (item.children) {
          return [item.id, ...item.children.map(child => child.id)];
        }
        return [item.id];
      });

      for (const section of sections) {
        const element = document.getElementById(section);
        if (element) {
          const rect = element.getBoundingClientRect();
          if (rect.top <= 150 && rect.bottom >= 150) {
            setActiveSection(section);
            break;
          }
        }
      }
    };

    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  return (
    <div className="min-h-screen bg-white">
      {/* Header - Same as landing page */}
      <header className="fixed top-0 left-0 right-0 bg-white/95 backdrop-blur-md shadow-lg z-50">
        <div className="max-w-7xl mx-auto px-6">
          <div className="flex items-center justify-between py-5">
            <Link
              href="/"
              className="flex items-center gap-3 transition-transform hover:scale-105"
            >
              <Image
                src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTYB48qcI4RmLRUfQqoGwJb6GIM7SqYE9rcBg&s"
                alt="Logo"
                width={48}
                height={48}
                className="rounded-xl shadow-md"
              />
              <h1 className="text-3xl font-bold bg-gradient-to-r from-red-900 to-red-700 bg-clip-text text-transparent">
                SITA-BI
              </h1>
            </Link>

            {/* Desktop Navigation */}
            <nav className="hidden md:flex items-center gap-10">
              <Link
                href="/"
                className="relative font-medium text-gray-800 hover:text-red-900 transition-colors"
              >
                Home
              </Link>
              <Link
                href="/dokumentasi"
                className="relative font-medium text-red-900"
              >
                Dokumentasi
                <span className="absolute -bottom-2 left-0 w-full h-0.5 bg-red-900" />
              </Link>
              <Link
                href="/login"
                className="bg-gradient-to-r from-red-900 to-red-800 text-white px-8 py-3 rounded-full font-semibold shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all"
              >
                Login
              </Link>
            </nav>

            {/* Mobile Menu Button */}
            <button
              onClick={() => setSidebarOpen(!sidebarOpen)}
              className="md:hidden text-red-900 p-2"
            >
              {sidebarOpen ? <X size={28} /> : <Menu size={28} />}
            </button>
          </div>
        </div>
      </header>

      <div className="flex pt-20">
        {/* Sidebar - Fixed position like NestJS docs */}
        <aside
          className={`
            fixed top-20 left-0 bottom-0 z-40
            w-72 bg-white border-r border-gray-200 overflow-y-auto
            transition-transform duration-300 ease-in-out
            ${sidebarOpen ? 'translate-x-0' : '-translate-x-full'}
            lg:translate-x-0
          `}
          style={{ 
            scrollbarWidth: 'thin',
            scrollbarColor: '#800000 #f3f4f6'
          }}
        >
          <nav className="p-6 space-y-1">
            {menuItems.map((item) => {
              const Icon = item.icon;
              const isActive = activeSection === item.id;
              const hasChildren = item.children && item.children.length > 0;
              const isExpanded = expandedMenus.includes(item.id);
              
              return (
                <div key={item.id}>
                  <button
                    onClick={() => {
                      if (hasChildren) {
                        toggleMenu(item.id);
                      } else {
                        scrollToSection(item.id);
                      }
                    }}
                    className={`
                      w-full flex items-center justify-between px-4 py-2.5 rounded-lg
                      transition-all duration-200 text-left text-sm font-medium
                      ${
                        isActive
                          ? 'bg-red-50 text-red-900'
                          : 'text-gray-700 hover:bg-gray-50'
                      }
                    `}
                  >
                    <div className="flex items-center space-x-3">
                      <Icon size={18} />
                      <span>{item.label}</span>
                    </div>
                    {hasChildren && (
                      <ChevronRight 
                        size={16} 
                        className={`transition-transform ${isExpanded ? 'rotate-90' : ''}`}
                      />
                    )}
                  </button>
                  
                  {hasChildren && isExpanded && (
                    <div className="ml-4 mt-1 space-y-1 border-l-2 border-gray-200 pl-4">
                      {item.children?.map((child) => {
                        const isChildActive = activeSection === child.id;
                        return (
                          <button
                            key={child.id}
                            onClick={() => scrollToSection(child.id)}
                            className={`
                              w-full text-left px-4 py-2 rounded-lg text-sm
                              transition-all duration-200
                              ${
                                isChildActive
                                  ? 'bg-red-50 text-red-900 font-medium'
                                  : 'text-gray-600 hover:bg-gray-50'
                              }
                            `}
                          >
                            {child.label}
                          </button>
                        );
                      })}
                    </div>
                  )}
                </div>
              );
            })}
          </nav>
        </aside>

        {/* Overlay untuk mobile */}
        {sidebarOpen && (
          <div
            className="fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden"
            onClick={() => setSidebarOpen(false)}
          />
        )}

        {/* Main Content */}
        <main className="flex-1 lg:ml-72">
          <div className="max-w-4xl mx-auto px-6 py-8">
            
            {/* Tim Pengembang Section - Using landing page style */}
            <section id="team" className="mb-20 scroll-mt-24">
              <div className="text-center mb-16">
                <p className="text-red-900 font-semibold text-sm uppercase tracking-widest mb-4">
                  Meet Our Team
                </p>
                <h2 className="text-5xl font-bold text-gray-900 mb-4">Team 7</h2>
                <p className="text-xl text-gray-600 max-w-2xl mx-auto">
                  Tim pengembang yang berdedikasi menciptakan SITA-BI untuk memudahkan proses tugas akhir
                </p>
              </div>
              <div className="grid md:grid-cols-2 gap-10">
                {teamMembers.map((member, idx) => (
                  <TeamMemberCard key={member.id} member={member} index={idx} />
                ))}
              </div>
            </section>

            {/* Pengenalan Section */}
            <section id="introduction" className="mb-16 scroll-mt-20">
              <div className="flex items-center space-x-3 mb-6">
                <BookOpen className="text-maroon" size={32} />
                <h2 className="text-3xl font-bold text-gray-900">Pengenalan</h2>
              </div>
              <div className="bg-white rounded-xl p-8 shadow-md border border-gray-100">
                <h3 className="text-2xl font-semibold text-maroon mb-4">
                  Apa itu SITA-BI?
                </h3>
                <p className="text-gray-700 leading-relaxed mb-4">
                  <strong>SITA-BI</strong> (Sistem Informasi Tugas Akhir - Business Intelligence) 
                  adalah platform digital yang dirancang khusus untuk mengelola seluruh proses 
                  tugas akhir mahasiswa secara terintegrasi dan efisien.
                </p>
                <p className="text-gray-700 leading-relaxed mb-4">
                  Sistem ini menghubungkan mahasiswa, dosen pembimbing, dan koordinator program 
                  studi dalam satu ekosistem digital yang mudah diakses dan digunakan.
                </p>
                <div className="bg-orange-50 border-l-4 border-maroon p-4 rounded-r-lg">
                  <p className="text-gray-800 font-medium">
                    ðŸ’¡ <strong>Tujuan:</strong> Mempermudah koordinasi, meningkatkan transparansi, 
                    dan mempercepat proses penyelesaian tugas akhir.
                  </p>
                </div>
              </div>
            </section>

            {/* Fitur Utama Section */}
            <section id="features" className="mb-16 scroll-mt-20">
              <div className="flex items-center space-x-3 mb-6">
                <Layout className="text-maroon" size={32} />
                <h2 className="text-3xl font-bold text-gray-900">Fitur Utama</h2>
              </div>
              <div className="grid gap-6">
                <div className="bg-white rounded-xl p-6 shadow-md border border-gray-100">
                  <h3 className="text-xl font-semibold text-maroon mb-3">
                    ðŸ“‹ Manajemen Tawaran Topik
                  </h3>
                  <p className="text-gray-700 leading-relaxed">
                    Dosen dapat menawarkan topik tugas akhir, dan mahasiswa dapat melihat 
                    serta mendaftar topik yang tersedia. Sistem memastikan setiap topik 
                    teralokasi dengan baik.
                  </p>
                </div>

                <div className="bg-white rounded-xl p-6 shadow-md border border-gray-100">
                  <h3 className="text-xl font-semibold text-maroon mb-3">
                    ðŸ“… Jadwal Sidang Otomatis
                  </h3>
                  <p className="text-gray-700 leading-relaxed">
                    Sistem mengatur jadwal sidang tugas akhir secara otomatis dengan 
                    mempertimbangkan ketersediaan dosen penguji dan ruangan.
                  </p>
                </div>

                <div className="bg-white rounded-xl p-6 shadow-md border border-gray-100">
                  <h3 className="text-xl font-semibold text-maroon mb-3">
                    ðŸ“¢ Pengumuman Real-time
                  </h3>
                  <p className="text-gray-700 leading-relaxed">
                    Koordinator dapat membuat pengumuman penting yang langsung diterima 
                    oleh mahasiswa dan dosen melalui notifikasi sistem.
                  </p>
                </div>

                <div className="bg-white rounded-xl p-6 shadow-md border border-gray-100">
                  <h3 className="text-xl font-semibold text-maroon mb-3">
                    ðŸ¤– AI Chatbot (SitaBot)
                  </h3>
                  <p className="text-gray-700 leading-relaxed">
                    Asisten virtual berbasis AI yang siap membantu menjawab pertanyaan 
                    seputar proses tugas akhir, panduan penggunaan sistem, dan informasi umum.
                  </p>
                </div>
              </div>
            </section>

            {/* Untuk Mahasiswa Section */}
            <section id="mahasiswa" className="mb-16 scroll-mt-20">
              <div className="flex items-center space-x-3 mb-6">
                <Code className="text-maroon" size={32} />
                <h2 className="text-3xl font-bold text-gray-900">
                  Panduan untuk Mahasiswa
                </h2>
              </div>
              <div className="bg-white rounded-xl p-8 shadow-md border border-gray-100">
                <div className="space-y-6">
                  <div>
                    <h3 className="text-xl font-semibold text-maroon mb-3">
                      1. Registrasi dan Login
                    </h3>
                    <ul className="list-disc list-inside text-gray-700 space-y-2 ml-4">
                      <li>Buat akun menggunakan email institusi</li>
                      <li>Verifikasi akun melalui email atau OTP</li>
                      <li>Login dengan kredensial yang telah dibuat</li>
                    </ul>
                  </div>

                  <div>
                    <h3 className="text-xl font-semibold text-maroon mb-3">
                      2. Memilih Topik Tugas Akhir
                    </h3>
                    <ul className="list-disc list-inside text-gray-700 space-y-2 ml-4">
                      <li>Akses menu "Tawaran Topik"</li>
                      <li>Browse topik yang tersedia dari berbagai dosen</li>
                      <li>Klik "Daftar" pada topik yang diminati</li>
                      <li>Tunggu konfirmasi dari dosen pembimbing</li>
                    </ul>
                  </div>

                  <div>
                    <h3 className="text-xl font-semibold text-maroon mb-3">
                      3. Monitoring Progress
                    </h3>
                    <ul className="list-disc list-inside text-gray-700 space-y-2 ml-4">
                      <li>Cek dashboard untuk melihat status tugas akhir</li>
                      <li>Upload dokumen konsultasi dan revisi</li>
                      <li>Komunikasi dengan dosen melalui sistem bimbingan</li>
                    </ul>
                  </div>

                  <div>
                    <h3 className="text-xl font-semibold text-maroon mb-3">
                      4. Jadwal Sidang
                    </h3>
                    <ul className="list-disc list-inside text-gray-700 space-y-2 ml-4">
                      <li>Lihat jadwal sidang di menu "Jadwal Sidang"</li>
                      <li>Persiapkan dokumen dan presentasi</li>
                      <li>Datang tepat waktu sesuai jadwal</li>
                    </ul>
                  </div>
                </div>
              </div>
            </section>

            {/* Untuk Dosen Section */}
            <section id="dosen" className="mb-16 scroll-mt-20">
              <div className="flex items-center space-x-3 mb-6">
                <Shield className="text-maroon" size={32} />
                <h2 className="text-3xl font-bold text-gray-900">
                  Panduan untuk Dosen
                </h2>
              </div>
              <div className="bg-white rounded-xl p-8 shadow-md border border-gray-100">
                <div className="space-y-6">
                  <div>
                    <h3 className="text-xl font-semibold text-maroon mb-3">
                      1. Mengelola Tawaran Topik
                    </h3>
                    <ul className="list-disc list-inside text-gray-700 space-y-2 ml-4">
                      <li>Login ke dashboard dosen</li>
                      <li>Buat tawaran topik baru dengan deskripsi lengkap</li>
                      <li>Tentukan kuota mahasiswa per topik</li>
                      <li>Terima atau tolak pendaftaran mahasiswa</li>
                    </ul>
                  </div>

                  <div>
                    <h3 className="text-xl font-semibold text-maroon mb-3">
                      2. Bimbingan Mahasiswa
                    </h3>
                    <ul className="list-disc list-inside text-gray-700 space-y-2 ml-4">
                      <li>Lihat daftar mahasiswa bimbingan</li>
                      <li>Review dokumen yang di-upload mahasiswa</li>
                      <li>Berikan feedback dan catatan konsultasi</li>
                      <li>Update status progress tugas akhir</li>
                    </ul>
                  </div>

                  <div>
                    <h3 className="text-xl font-semibold text-maroon mb-3">
                      3. Sidang Tugas Akhir
                    </h3>
                    <ul className="list-disc list-inside text-gray-700 space-y-2 ml-4">
                      <li>Cek jadwal sebagai penguji atau pembimbing</li>
                      <li>Input nilai dan catatan sidang</li>
                      <li>Approve hasil sidang mahasiswa</li>
                    </ul>
                  </div>
                </div>
              </div>
            </section>

            {/* Teknologi Section */}
            <section id="technology" className="mb-16 scroll-mt-20">
              <div className="flex items-center space-x-3 mb-6">
                <Zap className="text-maroon" size={32} />
                <h2 className="text-3xl font-bold text-gray-900">
                  Teknologi yang Digunakan
                </h2>
              </div>
              <div className="bg-white rounded-xl p-8 shadow-md border border-gray-100">
                <div className="grid md:grid-cols-2 gap-6">
                  <div>
                    <h3 className="text-lg font-semibold text-maroon mb-3">
                      Frontend
                    </h3>
                    <ul className="space-y-2 text-gray-700">
                      <li className="flex items-center space-x-2">
                        <span className="w-2 h-2 bg-maroon rounded-full"></span>
                        <span>Next.js 15</span>
                      </li>
                      <li className="flex items-center space-x-2">
                        <span className="w-2 h-2 bg-maroon rounded-full"></span>
                        <span>React 18</span>
                      </li>
                      <li className="flex items-center space-x-2">
                        <span className="w-2 h-2 bg-maroon rounded-full"></span>
                        <span>TypeScript</span>
                      </li>
                      <li className="flex items-center space-x-2">
                        <span className="w-2 h-2 bg-maroon rounded-full"></span>
                        <span>Tailwind CSS</span>
                      </li>
                    </ul>
                  </div>

                  <div>
                    <h3 className="text-lg font-semibold text-maroon mb-3">
                      Backend
                    </h3>
                    <ul className="space-y-2 text-gray-700">
                      <li className="flex items-center space-x-2">
                        <span className="w-2 h-2 bg-maroon rounded-full"></span>
                        <span>NestJS</span>
                      </li>
                      <li className="flex items-center space-x-2">
                        <span className="w-2 h-2 bg-maroon rounded-full"></span>
                        <span>PostgreSQL</span>
                      </li>
                      <li className="flex items-center space-x-2">
                        <span className="w-2 h-2 bg-maroon rounded-full"></span>
                        <span>Prisma ORM</span>
                      </li>
                      <li className="flex items-center space-x-2">
                        <span className="w-2 h-2 bg-maroon rounded-full"></span>
                        <span>Google Gemini AI</span>
                      </li>
                    </ul>
                  </div>
                </div>

                <div className="mt-8 pt-8 border-t border-gray-200">
                  <h3 className="text-lg font-semibold text-maroon mb-3">
                    Arsitektur Sistem
                  </h3>
                  <p className="text-gray-700 leading-relaxed">
                    SITA-BI dibangun dengan arsitektur <strong>monorepo</strong> menggunakan 
                    Turborepo untuk manajemen multi-package yang efisien. Frontend dan backend 
                    terpisah namun terintegrasi melalui REST API, dengan AI chatbot 
                    yang memanfaatkan Google Gemini API untuk memberikan respons cerdas.
                  </p>
                </div>
              </div>
            </section>

            {/* Footer Dokumentasi */}
            <footer className="mt-16 pt-8 border-t border-gray-200">
              <div className="bg-gradient-to-r from-maroon to-red-900 rounded-xl p-8 text-white text-center">
                <h3 className="text-2xl font-bold mb-2">Butuh Bantuan?</h3>
                <p className="mb-4 text-white/90">
                  Gunakan SitaBot AI Assistant di pojok kanan bawah untuk bertanya!
                </p>
                <Link
                  href="/"
                  className="inline-block bg-white text-maroon px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors"
                >
                  Kembali ke Beranda
                </Link>
              </div>
              <div className="text-center mt-6 text-gray-600 text-sm">
                <p>Â© 2024 SITA-BI. Dikembangkan oleh Tim Proyek Semester 5</p>
              </div>
            </footer>
          </main>
        </div>
      </div>
    </div>
  );
}
